{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Respaldo - Base de datos</title>
    <link rel="stylesheet" href="{% static 'css/gestion_respaldo.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="titulo-pagina">
        <h1>Respaldo - Base de datos</h1>
    </div>
    
    <div class="contenedor-principal">
        <!-- Columna izquierda - Tabla de respaldos -->
        <div class="columna-izquierda">
            <div class="panel-acciones">
                <button class="accion-boton principal" onclick="realizarRespaldo()">
                    <i class="fa-solid fa-database"></i> Realizar copia de seguridad
                </button>
            </div>
            
            <div class="panel-busqueda">
                <div class="busqueda-grupo">
                    <input type="text" id="buscarRespaldo" class="busqueda-input" placeholder="Buscar por nombre">
                    <button onclick="buscarRespaldo()" class="busqueda-boton">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </button>
                    <button onclick="limpiarBusqueda()" class="busqueda-boton secundario">
                        <i class="fa-solid fa-broom"></i>
                    </button>
                </div>
            </div>
            
            <div class="contenedor-tabla">
                <h2>Listado de las copias de la base de datos</h2>
                <table class="tabla-respaldos">
                    <thead class="tabla-respaldos__thead">
                        <tr class="tabla-respaldos__fila">
                            <th class="tabla-respaldos__columna"><input id="selectAll" type="checkbox"></th>
                            <th class="tabla-respaldos__columna">Nombre</th>
                            <th class="tabla-respaldos__columna">Opciones</th>
                        </tr>
                    </thead>
                    <tbody class="tabla-respaldos__tbody">
                        <!-- Las filas se llenarán dinámicamente con JavaScript -->
                    </tbody>
                </table>
                <div class="tabla-info" id="tablaInfo">
                    <!-- Se actualizará dinámicamente -->
                </div>
            </div>
        </div>
        
        <!-- Columna derecha - Información -->
        <div class="columna-derecha">
            <div class="panel-informacion">
                <h2>Información para la restauración de la base de datos</h2>
                <p>Antes de realizar la restauración de la base de datos, asegúrese de que haya hecho una copia.</p>
                
                <div class="pasos-seccion">
                    <h3><i class="fa-solid fa-database"></i> Pasos para una buena restauración:</h3>
                    <ol class="pasos-lista">
                        <li>Realice la copia respectiva</li>
                        <li>Asegúrese de que la copia esté visible en la tabla</li>
                        <li>Identifique la copia respectiva y seleccione la opción restaurar</li>
                        <li>Y listo, la copia se habrá restaurado exitosamente</li>
                    </ol>
                </div>
                
                <div class="pasos-seccion">
                    <h3><i class="fa-solid fa-trash"></i> Pasos para una eliminación exitosa:</h3>
                    <ol class="pasos-lista">
                        <li>Seleccione una de las copias en la respectiva tabla</li>
                        <li>Seleccione la opción de eliminar</li>
                        <li>Y listo, la copia se habrá eliminado exitosamente</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirmación -->
    <div class="respaldo-modal" id="respaldoModal" style="display: none;">
        <div class="respaldo-modal__contenido" id="contenidoRespaldo">
            <h3 id="modalTitulo">Confirmar acción</h3>
            <p id="modalMensaje">¿Está seguro que desea realizar esta acción?</p>
            {% csrf_token %}
        </div>
        <div class="respaldo-modal__acciones">
            <button class="respaldo-modal__boton confirmar" id="modalConfirmar">Confirmar</button>
            <button class="respaldo-modal__boton cancelar" onclick="cerrarModal()">Cancelar</button>
        </div>
    </div>
    
    <script>
        // Elimina la función getCookie() de aquí (ya está en el JS)
        // Solo deja el código del modal que no está en tu JS
        
        // Configuración inicial del modal
        document.addEventListener('DOMContentLoaded', function() {
            const csrftoken = getCookie('csrftoken');
            const csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrfmiddlewaretoken';
            csrfInput.value = csrftoken;
            document.getElementById('contenidoRespaldo').appendChild(csrfInput);
            
            document.getElementById('selectAll').addEventListener('change', function(e) {
                const checkboxes = document.querySelectorAll('.tabla-respaldos__tbody input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = e.target.checked;
                });
            });
        });
        
        function mostrarModal(titulo, mensaje, accion) {
            document.getElementById('modalTitulo').textContent = titulo;
            document.getElementById('modalMensaje').textContent = mensaje;
            document.getElementById('respaldoModal').style.display = 'block';
            
            const confirmarBtn = document.getElementById('modalConfirmar');
            confirmarBtn.onclick = accion;
        }
        
        function cerrarModal() {
            document.getElementById('respaldoModal').style.display = 'none';
        }
    </script>
    <script src="{% static 'javascript/menu_principal/subs_menus/gestion_respaldo.js' %}"></script>
</body>
</html>