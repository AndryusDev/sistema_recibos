{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Nóminas - Sistema Policial</title>
    <link rel="stylesheet" href="{% static 'css/importar_nomina.css' %}">
    <link rel="stylesheet" href="{% static 'css/recibo_pago.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <style>
        /* Added styles for concepto-checkbox */
        .concepto-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            background-color: #f0f4f8;
            padding: 8px 12px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: background-color 0.3s ease;
        }
        .concepto-checkbox:hover {
            background-color: #d9e6f2;
        }
        .concepto-checkbox input[type="checkbox"] {
            margin-right: 12px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .concepto-checkbox label {
            font-weight: 500;
            color: #003366;
            cursor: pointer;
            user-select: none;
        }
    </style>
</head>
<body>
    <div class="titulo-pagina">
        <h1>Gestión de Nóminas</h1>
    </div>
    
    <div class="contenedor-tabla-recibos">
        <!-- Panel de Búsqueda/Filtros -->
        <div class="panel-busqueda">
            <div class="busqueda-grupo">
                <div class="form-group">
                    <label for="filtro-tipo"><i class="fas fa-filter"></i> Tipo:</label>
                    <select id="filtro-tipo" class="busqueda-input">
                        <option value="">Todos los tipos</option>
                        {% for tipo in tipos_nomina %}
                        <option value="{{ tipo }}">{{ tipo }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="filtro-mes"><i class="fas fa-calendar"></i> Mes:</label>
                    <select id="filtro-mes" class="busqueda-input">
                        <option value="">Todos los meses</option>
                        {% for mes in mesess %}
                        <option value="{{ mes }}">{{ mes }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="filtro-anio"><i class="fas fa-calendar-alt"></i> Año:</label>
                    <select id="filtro-anio" class="busqueda-input">
                        <option value="">Todos los años</option>
                        {% for year in years_disponibles %}
                        <option value="{{ year }}">{{ year }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="filtro-orden"><i class="fas fa-sort"></i> Ordenar por:</label>
                    <select id="filtro-orden" class="busqueda-input">
                        <option value="-fecha_carga">Más reciente primero</option>
                        <option value="fecha_carga">Más antiguo primero</option>
                        <option value="tipo_nomina__tipo_nomina">Tipo (A-Z)</option>
                        <option value="-tipo_nomina__tipo_nomina">Tipo (Z-A)</option>
                        <option value="-fecha_cierre">Fecha cierre (reciente)</option>
                        <option value="fecha_cierre">Fecha cierre (antigua)</option>
                    </select>
                </div>
                <button id="btn-aplicar-filtros" class="busqueda-boton">
                    <i class="fas fa-search"></i> Buscar
                </button>
                <button id="btn-limpiar-filtros" class="busqueda-boton secundario">
                    <i class="fas fa-broom"></i> Limpiar
                </button>
                <button class="busqueda-boton" style="background-color: #003366;" onclick="importarnominaModal__abrir()">
                    <i class="fas fa-file-import"></i> Importar
                </button>
            </div>
        </div>
        
        <!-- Tabla de Nóminas -->
        <div class="tabla-recibo-linea">
            <table class="tabla-recibos" id="tablaNominas">
                <thead class="tabla-recibos__thead">
                    <tr class="tabla-recibos__fila">
                        <th class="tabla-recibos__columna">ID</th>
                        <th class="tabla-recibos__columna">Tipo</th>
                        <th class="tabla-recibos__columna">Período</th>
                        <th class="tabla-recibos__columna">Secuencia</th>
                        <th class="tabla-recibos__columna">Fecha Cierre</th>
                        <th class="tabla-recibos__columna">Fecha Carga</th>
                        <th class="tabla-recibos__columna">Acciones</th>
                    </tr>
                </thead>
                <tbody class="tabla-recibos__tbody" id="cuerpoTablaNominas">
                    <tr>
                        <td colspan="7" class="text-center">
                            <i class="fas fa-spinner fa-spin"></i> Cargando nóminas...
                        </td>
                    </tr>
                </tbody>
            </table>
            <div id="sin-resultados" class="text-center" style="display: none;">
                <p>No se encontraron nóminas con los filtros aplicados</p>
            </div>
            <div class="paginacion" id="paginacion">
                <!-- Paginación dinámica -->
            </div>
        </div>
    </div>
    
    <!-- Modal de Importación -->
    <div class="importarnomina-modal" id="importarnominaModal">
        <div class="importarnomina-modal__contenido" id="contenidoImportarnomina">
            <div class="recibo-modal__contenido">
                <div class="modal-header">
                    <h3><i class="fas fa-file-import"></i> Importar Nómina</h3>
                    <button class="btn-cerrar" onclick="importarnominaModal__cerrar()">&times;</button>
                </div>
                
                <div class="modal-body">
                    <!-- Paso 1: Selección de tipo de nómina -->
                    <div class="paso-importacion activo" data-paso="1">
                        <div class="form-group">
                            <label for="modal-tipo-nomina"><i class="fas fa-list-check"></i> Tipo de Nómina:</label>
                            <select id="modal-tipo-nomina" name="tipo_nomina" class="busqueda-input" required>
                                <option value="">Seleccione un tipo</option>
                                {% for tipo in tipos_nomina %}
                                    <option value="{{ tipo }}">{{ tipo }}</option>
                                {% empty %}
                                    <option value="">No hay tipos disponibles</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="info-ayuda">
                            <i class="fas fa-info-circle"></i> Seleccione el tipo de nómina que desea importar
                        </div>
                    </div>
                    
                    <!-- Paso 2: Período, secuencia y fecha de cierre -->
                    <div class="paso-importacion" data-paso="2">
                        <div class="form-group">
                            <label for="modal-mes"><i class="fas fa-calendar"></i> Mes:</label>
                            <select id="modal-mes" name="mes" class="busqueda-input" required>
                            <option value="">Seleccione un mes</option>
                                {% for m in mesess %}
                                    <option value="{{ m }}">{{ m }}</option>
                                {% empty %}
                                    <option value="">No hay meses disponibles</option>
                                {% endfor %}
                        </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="modal-anio"><i class="fas fa-calendar-alt"></i> Año:</label>
                            <input type="number" id="modal-anio" class="busqueda-input" min="2020" max="2030" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="modal-secuencia"><i class="fas fa-sort-numeric-up"></i> Secuencia:</label>
                            <select id="modal-secuencia" class="busqueda-input" required>
                                <option value="">Seleccione la secuencia</option>
                                {% for secuencia in secuencia_mes %}
                                <option value="{{ secuencia }}">{{ secuencia }}</option>
                                {% empty %}
                                <option value="">No hay secuencias disponibles</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="modal-fecha-cierre"><i class="fas fa-calendar-check"></i> Fecha de Cierre:</label>
                            <input 
                                type="date" 
                                id="modal-fecha-cierre" 
                                class="busqueda-input" 
                                required
                                min="2020-01-01"
                                max="2030-12-31"
                            >
                        </div>
                        <input type="hidden" id="modal-periodo" name="periodo" value="2">
                        
                        <div class="info-ayuda">
                            <i class="fas fa-info-circle"></i> Especifique el período, secuencia y fecha de cierre de la nómina
                        </div>
                    </div>
                    
                    <!-- Paso 3: Selección de conceptos -->
                    <div class="paso-importacion" data-paso="3" id="paso-conceptos">
                        {% for concepto in conceptos %}
                        <div class="concepto-checkbox">
                            <input
                                type="checkbox"
                                id="concepto-{{ concepto.codigo }}"
                                data-codigo="{{ concepto.codigo }}"
                                {% if concepto.tipo_aplicacion == 'QUINCENA' %}checked{% endif %}
                            >
                            <label for="concepto-{{ concepto.codigo }}">
                                {{ concepto.descripcion }} ({{ concepto.codigo }})
                            </label>
                        </div>
                        {% empty %}
                        <p>No hay conceptos disponibles para seleccionar.</p>
                        {% endfor %}
                    </div>
                    
                    <!-- Paso 4: Confirmación -->
                    <div class="paso-importacion" data-paso="4">
                        <div class="resumen-importacion">
                            <h4><i class="fas fa-check-circle"></i> Resumen de Importación</h4>
                            
                            <div class="resumen-item">
                                <span>Tipo de Nómina:</span>
                                <strong id="resumen-tipo">-</strong>
                            </div>
                            
                            <div class="resumen-item">
                                <span>Período:</span>
                                <strong id="resumen-periodo">-</strong>
                            </div>
                            
                            <div class="resumen-item">
                                <span>Archivo:</span>
                                <strong id="resumen-archivo">-</strong>
                            </div>
                            
                            <div class="resumen-item">
                                <span>Fecha de Cierre:</span>
                                <strong id="resumen-fecha-cierre">-</strong>
                            </div>
                            
                            <div class="advertencia-importacion">
                                <i class="fas fa-exclamation-triangle"></i>
                                <p>Revise cuidadosamente la información antes de confirmar. Esta acción no se puede deshacer.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="recibo-modal__acciones">
                    <div class="indicador-pasos">
                        <span class="paso" data-paso="1">1</span>
                        <span class="paso" data-paso="2">2</span>
                        <span class="paso" data-paso="3">3</span>
                        <span class="paso" data-paso="4">4</span>
                    </div>
                    
                    <div class="botones-navegacion">
                        <button id="btn-anterior" class="recibo-modal__boton btn-anterior" disabled>
                            <i class="fas fa-arrow-left"></i> Anterior
                        </button>
                        <button id="btn-siguiente" class="recibo-modal__boton btn-siguiente" style="background-color: #006666;">
                            Siguiente <i class="fas fa-arrow-right"></i>
                        </button>
                        <button id="btn-importar" class="recibo-modal__boton btn-importar" style="background-color: #003366;">
                            <i class="fas fa-check"></i> Confirmar Importación
                        </button>
                        <button id="btn-cancelar" class="recibo-modal__boton btn-cancelar" style="background-color: #6c757d;">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="{% static 'javascript/menu_principal/subs_menus/importar_nomina.js' %}" defer></script>
    <script>
        // Configuración global
        const CSRF_TOKEN = "{{ csrf_token }}";
        const API_NOMINAS_URL = '/api/nominas/';  // O la ruta correcta a tu endpoint
    </script>
</body>
</html>