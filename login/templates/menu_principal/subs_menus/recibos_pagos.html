{% load static %}
<!DOCTYPE html>
<html lang="es">
    <head>
        {% load static %}
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Recibos de Pago</title>
        <link rel="stylesheet" href="{% static 'css/recibos_pagos.css' %}">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    </head>
    <body>
        <div class="titulo-pagina">
            <h1>Listado de Recibos de Pago</h1>
        </div>
        <div class="contenedor-tabla-recibos">
            <div class="panel-busqueda">
                <div class="busqueda-grupo">
                    <input type="text" id="buscarFecha" class="busqueda-input" placeholder="Buscar por fecha (ej: Mar/2025)">
                    <button onclick="buscarPorFecha()" class="busqueda-boton">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </button>
                    <button onclick="limpiarBusqueda()" class="busqueda-boton secundario">
                        <i class="fa-solid fa-broom"></i>
                    </button>
                </div>
                
                <!-- Selector de empleados SOLO para administradores -->
                {% if es_administrador %}
                <div class="busqueda-grupo">
                    <select id="filtroEmpleado" class="busqueda-input" onchange="filtrarPorEmpleado()">
                        <option value="">Todos los empleados</option>
                        {% for emp in empleados_disponibles %}
                            <option value="{{ emp.cedula }}" {% if emp.cedula == empleado_filtrado %}selected{% endif %}>
                                {{ emp.get_nombre_completo|upper }}
                            </option>
                        {% endfor %}
                    </select>
                    <button onclick="limpiarFiltroEmpleado()" class="busqueda-boton secundario">
                        <i class="fa-solid fa-user-slash"></i>
                    </button>
                </div>
                {% endif %}
            </div>
            
            <div class="tabla-recibo-linea">
                <table class="tabla-recibos tabla-estandar">
                    <thead class="tabla-recibos__thead">
                        <tr class="tabla-recibos__fila">
                            <th class="tabla-recibos__columna">ID</th>
                            <th class="tabla-recibos__columna">Fecha</th>
                            <th class="tabla-recibos__columna">Nombre</th>
                            <th class="tabla-recibos__columna">Cargo</th>
                            <th class="tabla-recibos__columna">Acciones</th>
                        </tr>
                    </thead>
                    <tbody class="tabla-recibos__tbody">
                        {% for recibo in recibos %}
                        <tr class="tabla-recibos__fila">
                            <td class="tabla-recibos__celda">{{ recibo.id }}</td>
                            <td class="tabla-recibos__celda">{{ recibo.fecha_generacion|date:"d/M/Y" }}</td>
                            <td class="tabla-recibos__celda">{{ recibo.cedula.get_nombre_completo|upper }}</td>
                            <td class="tabla-recibos__celda">{{ recibo.cedula.cargo.nombre_completo|upper }}</td>
                            <td class="tabla-recibos__celda">
                                <button class="tabla-recibos__boton" 
                                        data-recibo-id="{{ recibo.id }}" 
                                        onclick="abrirRecibo(this)">
                                    Ver Recibo
                                </button>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center">No se encontraron recibos registrados.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Modal del recibo -->
        <div class="recibo-modal" id="reciboModal">
            <div class="recibo-modal__contenido" id="contenidoRecibo"></div>
            <div class="recibo-modal__acciones">
                <button class="recibo-modal__boton" onclick="ImprimirRecibo()">Imprimir</button>
                <button class="recibo-modal__boton" onclick="reciboModal__cerrar()">Cerrar</button>
            </div>
        </div>

        <script src="{% static 'javascript/menu_principal/subs_menus/recibos_pagos.js' %}"></script>
        <script>
            // Función para filtrar por empleado (solo para administradores)
            function filtrarPorEmpleado() {
                const empleadoId = document.getElementById("filtroEmpleado").value;
                const urlParams = new URLSearchParams(window.location.search);
                
                if (empleadoId) {
                    urlParams.set('empleado_id', empleadoId);
                } else {
                    urlParams.delete('empleado_id');
                }
                
                window.location.search = urlParams.toString();
            }
            
            // Función para limpiar filtro de empleado
            function limpiarFiltroEmpleado() {
                document.getElementById("filtroEmpleado").value = "";
                filtrarPorEmpleado();
            }
        </script>
    </body>
</html>